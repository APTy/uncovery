var expect = require('chai').expect;
var fs = require('fs');
var util = require('../server/core/utilities');
var img64 = 'data:image/jpg;base64,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'

describe('Utilities', function() {
  it('should get the amount of time that has elapsed', function() {
    var past = Date.now()-60000;
    var elapsed = util.getTimeElapsedSince(past);
    expect(elapsed).to.equal('a minute ago');
  });

  it('should get a distance from a location', function() {
    var dist = util.getDistanceFrom({
      x: 38,
      y: -122
    }, {
      x: 37,
      y: -122
    });
    dist = Math.round(dist.replace('m','')/1000)*1000;
    expect(dist).to.equal(111000);
  });

  it('should save an image file and upload it to AWS S3', function(done) {
    util.saveImage(img64, function(imgName) {
      var filename = 'server/images/' + imgName + '.jpg';
      fs.unlink(filename, function(err) {
        if (err) throw err;
        done();
      });
    }, true);
  });
});
